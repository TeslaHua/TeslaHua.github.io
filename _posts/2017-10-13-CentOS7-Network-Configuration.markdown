---
layout: post
category: "Linux"
title:  "主机硬盘最小安装CentOS7系统后网络配置的问题"
tags: [CentOS7,静态IP,网络配置]
---
**提示: 本篇博客主要针对硬盘安装centOS7系统后网络配置的问题**

### 1. 网络配置道路上的前期探索

   由于当时装系统的时候没有对主机名和网络进行操作，所以登录后ping www.baidu.com肯定是不通的，所以开始探索吧。网上很多资料都是说用命令**ifconfig**来查看网络目前信息，但是最小安装的CentOS7系统并没有此命令，需要下载安装，但是并没有网，GG。但是可以使用**ip addr**命令查看，发现并没有分配IP地址给我的电脑。
<!-- more -->

#### (1). DHCP动态分配地址

   进入/etc/sysconfig/network-scripts/目录，使用ls命令查看，里面应该有一个**ifcfg-eXXXX（每个电脑的XXX可能不一样，我的是em1,也有的是eno*****后面一串数字的）**的，然后用vi打开它,里面可能是如下图所示，然后将ONBOOT从no改为yes(**启动系统时激活网卡**)。

   ![yes](https://thumbnail0.baidupcs.com/thumbnail/91146d01ffeb9fba84a53c49728c87af?fid=559684340-250528-1006652403511289&time=1507856400&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-ihPHxlmtG1BLS97wEXEXuKWWRq4%3d&expires=8h&chkbd=0&chkv=0&dp-logid=6619392610930247244&dp-callid=0&size=c10000_u10000&quality=90&vuk=559684340&ft=image)

   此时BOOTPROTO仍然是dhcp动态分配IP地址，然后service network restart 重启网络服务，此时再输入命令**ip addr**，我们可以看到下图显示已经分配了IP地址给这台机器，此时你在尝试ping www.baidu.com 或许就可以通了哦：

   ![ipaddr](https://pcs.baidu.com/rest/2.0/pcs/thumbnail?method=generate&app_id=250528&path=%2FBlogImages%2Fipaddr.jpg&quality=90&size=c10000_u10000)

#### (2). static静态IP的配置

   1.首先配置DNS(域名解析器)
    
   输入命令： vi /etc/resolv.conf，添加DNS如下：

    nameserver 114.114.114.114 #国内用户使用的比较多，而且速度相对快、稳定
    nameserver 8.8.8.8         #GOOGLE公司提供的DNS，该地址是全球通用的，相对来说，更              适合国外以及访问国外网站的用户使用

   **（这里注意一下：打开这个文件默认的DNS时192.168.1.1这个是我本地的DNS，而且是显示
   Generated by NetworkManager，就是默认NetworkManager管理DNS，这就导致开机恢复默认DNS，从而新设置的DNS无效。这个NetworkManager好像是Centos7新的一项网络服务，但是原来的network也能用，我为了不产生冲突，就永久的关闭了NetworkManager服务，关闭的代码如下：）**

     systemctl stop NetworkManager.service  #关闭此项服务
     systemctl disable NetworkManager.service  #开机时不启动此项服务
     systemctl start network.service  #开启network.service服务 

   设置完之后我们可以查看一下NetworkManager.service的状态和network.service的状态，如下图所示，里面的分析不知道对不对，大神勿喷哦：

   ![status](https://thumbnail0.baidupcs.com/thumbnail/5284afb442c0ada3a34b5459526b627c?fid=559684340-250528-501780878249465&time=1507874400&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-6pSxLnlU35aFwiaaq%2bkzO0KcXLY%3d&expires=8h&chkbd=0&chkv=0&dp-logid=6624221273830623004&dp-callid=0&size=c10000_u10000&quality=90&vuk=559684340&ft=image)


   手机拍的，比较粗略，抱歉。

   ![status1](https://thumbnail0.baidupcs.com/thumbnail/c94f048c84466acbbc3a1418c135a2b8?fid=559684340-250528-246095078947728&time=1507874400&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-M6GclQ4dA6yyS4bNLoulbpPiBDw%3d&expires=8h&chkbd=0&chkv=0&dp-logid=6624221273830623004&dp-callid=0&size=c10000_u10000&quality=90&vuk=559684340&ft=image)

   鸟哥的私房菜里面讲解的关于系统服务的资料可以看下面的：

   <http://linux.vbird.org/linux_basic/0560daemons.php>

   2.配置网关

   进如/etc/sysconfig/文件夹，vi打开network，配置以下内容,结果见下图：

    NETWORKING=yes #表示系统是否使用网络，一般设置为yes。如果设为no，则不能使用网络。

    HOSTNAME=teslahua #设置本机的主机名，这里的主机名要和/etc/hosts中设置的主机名对应

    GATEWAY=192.168.1.1 #设置本机连接的网关的IP地址。

   关于设置主机名：

    vi /etc/hostname   #编辑配置文件

    teslahua   #修改localhost.localdomain为teslahua

    vi /etc/hosts #编辑配置文件

    127.0.0.1   localhost  teslahua   #修改localhost.localdomain为teslahua

   ![gateway](https://pcs.baidu.com/rest/2.0/pcs/thumbnail?method=generate&app_id=250528&path=%2FBlogImages%2Fgateway.jpg&quality=90&size=c10000_u10000)

   3.开始配置静态IP 

   同样vi打开/etc/sysconfig/network-scripts/下面的ifcfg-eXXXX文件，添加以下几行命令，并**把BOOTPROTO的dhcp改为static**(分配静态IP)，然后保存退出即可。

    IPADDR=192.168.1.102   #设置IP地址
    NETMASK=255.255.255.0  #设置子网掩码
    GATEWAY=192.168.1.1    #设置网关
    DNS1=114.114.114.114   #设置主DNS
    DNS2=8.8.8.8           #设置备DNS


   ![ifcfg-em1](https://pcs.baidu.com/rest/2.0/pcs/thumbnail?method=generate&app_id=250528&path=%2FBlogImages%2Fifcfg-em1.jpg&quality=90&size=c10000_u10000)

   **提示：  一定要重启一下network服务哦： **

    service network restart    #老版指令
    systemctl restart network  #新版指令

   到这里CentOS7正常的网络配置就结束了。

   附上以下新版systemctl指令的相关命令：

    启动一个服务：systemctl start postfix.service
    关闭一个服务：systemctl stop postfix.service
    重启一个服务：systemctl restart postfix.service
    显示一个服务的状态：systemctl status postfix.service
    在开机时启用一个服务：systemctl enable postfix.service
    在开机时禁用一个服务：systemctl disable postfix.service
    查看服务是否开机启动：systemctl is-enabled postfix.service
    查看已启动的服务列表：systemctl list-unit-files|grep enabled

   关于CentOS系统网络配置的资料可参考下面的资料：

   <http://blog.csdn.net/jcxch/article/details/48632761>


### 2. 一切才刚刚开始

**提示：一定要确定自己的以上基础配置要正确哦**

#### (1). 各种 ping 
  
   卧槽，百度ping不通，百分百丢包。开始分析吧，各种百度，XX-net这几天又不争气，ip封的厉害。远程服务器ping 不同；

   就ping 自己的路由器吧，开始ping 网关，ping 192.168.1.1，还是ping不通啊，shit；

   自己的路由器都ping 不通，那就ping 局域网内的其它主机吧，ping 我自己的笔记本ping 192.168.1.109,还是不行哦；

   反过来试试吧，但是我的笔记本能够ping 的通自己的centOS7台式机。

   于是想是不是自己的笔记本的防火墙的事呢，关掉自己的笔记本防火墙，居然能ping 通了。

   于是想是不是自己的路由器上的防火墙的原因呢，**虽然这个可能性很小，姑且试试吧**，开始关闭路由器的防火墙，但是并不是这个原因。

#### (2). 转战路由器

   既然自己在被动的要求路由器分给自己静态地址，干脆自己直接去路由器配置静态IP绑定自己的主机。
 
   不去不知道，一去吓一跳啊。 

   在静态ARP绑定那里居然有一个主机MAC地址和分配给我的IP地址192.168.1.102绑定了，真坑啊。

   如果有主机和你的IP地址绑定之后，当这个主机没有上线的时候，路由器有可能把这个地址再分配给别的主机（比如我的主机），但是你如果还想把这个地址当作静态地址绑定到你自己的主机上，就不会成功。

   哈哈，所以我就编辑了一下，把我的主机的MAC地址绑定到了这个IP地址。如下所示，所以经过差不多一天的时间，终于成功配置完成了，经测试，已经可以成功的ping通内网和外网了。

   ![route](https://thumbnail0.baidupcs.com/thumbnail/134bbb1a0c5fb666246628f03c797841?fid=559684340-250528-1119019000027602&time=1507881600&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-vMTo1faZeBPY3LkhCMAJYipz%2bcA%3d&expires=8h&chkbd=0&chkv=0&dp-logid=6625519485950431391&dp-callid=0&size=c10000_u10000&quality=90&vuk=559684340&ft=image)

   关于路由器的有关资料请参考以下链接：

   <http://bbs.51cto.com/viewthread.php?tid=1435376&extra=&page=2>

   <http://support.huawei.com/enterprise/docinforeader.action?contentId=DOC1000097141&idAbsPath=7919710>
   
   

  

   



   
 


 














